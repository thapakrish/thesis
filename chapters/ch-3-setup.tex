\chapter{Experimental Setup} \label{ch:expSetup}

This chapter describes the experimental facility used in the particle physics experiments. Section
\ref{sec:LHC} covers the Large Hadron Collider (LHC), the accelerator complex responsible for delivering pp collisions to each experiment at CERN. Section \ref{sec:CMS} discusses the CMS detector. The Pixel Luminosity Telescope (PLT), the dedicated online luminometer for the CMS experiment is described in Section \ref{sec:PLT}.

\section{Large Hadron Collider} \label{sec:LHC}

%wo
The Large Hadron Collider (LHC), first conceived in the 1980s, is the most powerful accelerator ever built with the aim of finding Higgs boson and search for particles and forces that interact between them not included in the SM. The collider is 27 kilometers in circumference and is placed 100 meters underground at the border between France of Switzerland near Geneva. 

\begin{figure}[htbp!]
  % trim = {<left> <lower> <right> <upper>}
  \includegraphics[width=1.0\textwidth, trim = {3.5cm 2.0cm 3.5cm 1.8cm}, clip]%
%  \includegraphics[width=1.0\textwidth, trim = {3cm 5cm 3cm 1.5cm}, clip]%
    {figures/cern/cernaccelerators.jpg}% picture filename
        \captionsetup{format=hang}
    \caption{Layout of CERN accelerator complex. The four LHC experiments CMS, ALICE, ATLAS, and LHCb also shown \cite{fig:symMag}.}
    \label{fig:cern}
\end{figure}



%\begin{sidewaysfigure}[htbp!]
%  % trim = {<left> <lower> <right> <upper>}
%  \includegraphics[width=1.0\textwidth, trim = {3.5cm 2.0cm 3.5cm 1.8cm}, clip]%
%%  \includegraphics[width=1.0\textwidth, trim = {3cm 5cm 3cm 1.5cm}, clip]%
%    {figures/cern/cern_complex.pdf}% picture filename
%        \captionsetup{format=hang}
%    \caption{Layout of the CERN accelerator complex with four LHC experiments CMS, ALICE, ATLAS, and LHCb \cite{Christiane:1260465}.}
%    \label{fig:cern}
%\end{sidewaysfigure}



The LHC is the last step of a multi-stage chain of accelerators called the LHC accelerator complex as shown in Fig. \ref{fig:cern}. Hydrogen gas atoms are stripped off electrons and the remaining protons are accelerated in the 80 m long Linac 2 linear accelerator to a kinetic energy of 50 MeV. Protons then pass through three pre-accelerators Proton Synchotron Booster (PSB), Proton Synchotron (PS), and Super Proton Synchrotron (SPS) where they are accelerated to 1.4 GeV, 25 GeV, and 450 GeV, respectively. The proton beams are injected into the LHC ring where they are accelerated further to 6.5 TeV in opposite directions resulting a center-of-mass collision energy of 13 TeV.

%directed The LHC is made up of 1232 dipole magnets that direct proton beams to their circular path.

Proton beams are segmented into groups of protons called bunches. Beams are kept on a circular path by 1232 dipole magnets located at various points around the ring. The magnetic field of 8.3 T operated at an ultracold temperature of  2 K (~456 F) is generated by a superconducting coil cooled with liquid helium. Points 1, 2, 5, and 8 on the LHC ring are the interaction points where the beams overlap to produce collisions. Point 3 and 7 contain the beam collimation systems, and point 6 contains the beam dump system. The CMS experiment is located at interaction point 5.

\subsection{Filling Scheme} \label{sec:fillScheme}

Many protons are packed into each bunch to maximize the probability of a proton-proton collision for a given bunch crossing. Several filling patterns have been designed for various modes of operations of the LHC \cite{fill-schemes}. Typically, beams are arranged in the form of batches each with some continuous set of filled bunches. 

%\begin{sidewaysfigure}[htbp!]
\begin{figure}[htbp!]
  \includegraphics[width=1.0\textwidth]%
    {figures/instrument/25ns_fill_scheme.png}% picture filename
    \captionsetup{format=hang}
    \caption{Schematic of the Bunch Disposition around an LHC Ring for the 25 ns Filling Scheme \cite{fill-schemes}. 'b' and 'e' indicate beam position with  or without beam. }
    \label{fig:fill-schemes}
\end{figure}    
%\end{sidewaysfigure}


The principle scheme for luminosity production is the 25 ns filling scheme, as shown in Figure \ref{fig:fill-schemes}, where each batch has 72 bunches totaling 2808 filled bunches. Gaps between the batches allow for the SPS and LHC fast injection magnets to change magnetic field, and the gap of 119 unfilled bunches at the end allows for the fast magnet that redirects the LHC beam into a beam dump to obtain full field strength. Each 25 ns bunch is confined to about 7.5 m out of the 27 km total distance in a given orbit.



\subsection{LHC Operations in 2015 and 2016} \label{sec:lhcOP}


The result described in this work is an analysis of the data taken with the Pixel Luminosity Detector for the CMS experiment during the operation of the LHC in 2015 and 2016. The center-of-mass energy of the pp collisions was 13 TeV. The average number of collision per bunch crossings, pileup, is shown in Figure ~\ref{fig:pileup} for this period.


%a mean number of interactions per bunch crossing.
%Average number of interaction per bunch crossing:Pileup
% TODO:  add average pileup plot, describe what pileup is


% change it with 2015/2016 pileup 

\begin{figure}[htbp!]
\centering
  \includegraphics[width=0.8\textwidth]%
    {figures/cms/pileup_pp_2012.pdf}% picture filename
    \captionsetup{format=hang}
    \caption{Mean number of interactions per bunch crossing, 2012.}
    \label{fig:pileup}
\end{figure}







\section{CMS} \label{sec:CMS}

%copied
Compact Muon Solenoid is one of two general-purpose particle-physics detectors on the LHC. It is designed to investigate a wide range of particles and phenomenon produced in the proton-proton collisions. The primary motivation for building this detector was to search for the Higgs boson and probe the standard model at energy scales above 1 TeV. This could shed some light into extensions of SM such as extra dimensions, supersymmetry , dark matter, and also gravity models around TeV scale. 



%%wo
The CMS coordinate system, as shown in Fig ~\ref{fig:CMS:Coordinate}, is defined with the origin at the center of the detector. It is oriented such that the $z$-axis points along the LHC ring in a counterclockwise direction, $x$-axis towards the center of the LHC ring, and the $y$-axis vertically upwards above ground. 

% http://tex.stackexchange.com/questions/117140/easiest-way-to-draw-a-3d-coordinate-system-with-axis-labels-and-ticks-in-tikz
\begin{figure}[htbp!]
\centering
\begin{tikzpicture}[x=0.5cm,y=0.5cm,z=0.3cm,>=stealth,scale=0.8]
% The axes
\draw[->] (xyz cs:x=-7.5) -- (xyz cs:x=7.5) node[above] {$z$};
\draw[->] (xyz cs:y=-7.5) -- (xyz cs:y=7.5) node[right] {$y$};
\draw[->] (xyz cs:z=-7.5) -- (xyz cs:z=7.5) node[above] {$x$};
\node[align=center] at (3,-3) (ori) {(0,0,0)\\\text{IP}};
\draw[->,help lines,shorten >=3pt] (ori) .. controls (1,-2) and (1.2,-1.5) .. (0,0,0);
\end{tikzpicture}
\caption{CMS Coordinate System with positive x towards the center of the ring.} \label{fig:CMS:Coordinate}
\end{figure}


In the cylindrical coordinate system,  $r$ is the radius in the $x-y$ plane, $\phi$ the azimuthal
angle in the $+x$ direction, and $\theta$ the polar angle in the $+z$ direction. The four-momentum of a particle can be written as

$$
p =   \begin{pmatrix}
    E\\
    \vec{p}\\
  \end{pmatrix}  
$$
where $\vec{p} = (p_{x}, p_{y}, p_{z})$ in cartesian basis. The transverse momentum $p_{T}$ in $r - \phi $ plane is given by 
$$ 
p_{T} = \sqrt{p_{x}^{2} + p_{y}^{2}}
$$

Particle kinematics can then be described by azimuthal angle, transverse momentum, and rapidity, y. Rapidity is additive under Lorentz transformations along the $z$ axis and is given by
$$
y = \frac{1}{2} \ln \left( \frac{E+p_{z}}{E-p_{z}} \right)
$$

For relativistic particles, the rapidity equals the pseudo-rapidity $\eta$, which is related to the particle polar coordinate by the following relation

$$
\eta = -\ln(\tan(\theta/2))
$$


\begin{figure}
\centering
\begin{tikzpicture}
    \draw[thick,->] (0,0) -- (4.5,0) node[anchor=north west] {$\theta = 90^{\circ}, \eta =\infty $};
%    \draw[thick] (0,0) -- (1,1)--(2,2)--(4,4) node[anchor=north west] {$\theta = 45^{\circ},\eta =0.88 $};
    \draw[thick,->] (0,0) -- (0,4.5) node[anchor=south east] {$\theta = 0^{\circ}, \eta = 0$};
        % Draw a line at 30 degrees and of length 3
        
    \draw (0,0) -- (10:4.5cm) node[above]  {$\theta = 10^{\circ},\eta =2.44 $};
   \draw (0,0) -- (45:4.5cm) node[above]  {$\theta = 45^{\circ},\eta =0.88 $};
%    \draw[thick] (0,0) -- (1,1)--(2,2)--(4,4) node[anchor=north west] {$\theta = 45^{\circ},\eta =0.88 $};
    
\end{tikzpicture}    
    \caption{Relationship between polar angle and pseudorapidity.}
\end{figure}


\begin{figure}[htbp!]
\centering
  \includegraphics[width=1.0\textwidth]%
    {figures/lumi/int_lumi_cumulative_pp_2.png}% picture filename
    \captionsetup{format=hang}
    \caption{Delivered Luminosity versus time for several years of data taking of pp collisions with the CMS detector \cite{CMS:lumi}. }
\end{figure}





%\begin{sidewaysfigure}[htbp!]
\begin{figure}[htbp!]
\centering
  \includegraphics[width=1.0\textwidth]%
    {figures/CMS/cms_160312_02.pdf}% picture filename
    \captionsetup{format=hang}
    \caption{CMS Detector \cite{fig:CMSDetector}. }
\end{figure}
%\end{sidewaysfigure}



%CMS is described in greater detail in \cite{Chatrchyan:2008}, \cite{cms:solenoid}.
The central feature of the CMS apparatus is a superconducting solenoid of 6 {m} internal diameter, providing a magnetic field of 3.8 {T}. Within the superconducting solenoid volume are a silicon pixel and strip tracker, a lead tungstate crystal electromagnetic calorimeter (ECAL), and a brass and scintillator hadron calorimeter (HCAL), each composed of a barrel and two endcap sections. Forward calorimeters extend the pseudorapidity~\cite{Chatrchyan:2008} coverage provided by the barrel and endcap detectors. Muons are measured in gas-ionization detectors embedded in the steel flux-return yoke outside the solenoid.



Precise position measurement of charged particles coupled with a strong magnetic field of the solenoid provides the parameters necessary for momentum resolution. The Electromagnetic Calorimeter and Hadronic Calorimeter provide the energy resolution. The Muon System and the silicon tracker measure the charged muon and inclusive particle positions respectively. The silicon tracker measures charged particles within the pseudorapidity range $\abs{\eta} < 2.5$. It consists of 1440 silicon pixel and 15,148 silicon strip detector modules and is located in the 3.8 {T} field of the superconducting solenoid. For nonisolated particles of $1 <  p_{T} < 10 GeV$ and $\abs{\eta} < 1.4$, the track resolutions are typically 1.5\% in $p_{T}$ and 25--90 (45--150)$\mu$m in the transverse (longitudinal) impact parameter \cite{TRK-11-001}. 
A more detailed description of the CMS detector, together with a definition of the coordinate system used and the relevant kinematic variables, can be found in Ref.~\cite{Chatrchyan:2008}.



\section{Silicon Pixel Detectors} \label{sec:siliconpixel}
Pixel detectors are used to measure increasing number of charged particles at high energies in particle physics experiments. As the name suggests, silicon sensor is segmented into smaller pixel elements because of which events can be identified with high space and time resolution. As such, these detectors are also an excellent choice to study short-lived particles.

\begin{figure}[htbp!]
\centering
  \includegraphics[width=0.8\textwidth]%
%    % trim = {<left> <lower> <right> <upper>}
%  \includegraphics[width=1.0\textwidth, trim = {1cm 1cm 1cm 0.8cm}, clip]%
    {figures/instrument/PixelSensor.png}% picture filename
    \captionsetup{format=hang}
    \caption{Schematic view of a pixel sensor \cite{Rossi2003239}.}
    \label{fig:sensor}
\end{figure}

The sensor element of the pixel detector is typically few $mm^{2}$. For silicon sensors in particular, about $3.6$ eV energy deposition produces an electron-hole pair. The charges produced by the traveling charged particle on the silicon sensor is collected using an external electric field produced by a reverse-biased pn junction. This provides the electric field required to collect the charges formed and also suppresses the free charges. Figure \ref{fig:sensor} shows the schematic of building blocks of a pixel detector.

\section{Pixel Luminosity Telescope} \label{sec:PLT}

%\subsubsection {Overview}

\begin{figure}[htbp!]
\centering
%  \includegraphics[width=1.0\textwidth]%
%    % trim = {<left> <lower> <right> <upper>}
  \includegraphics[width=1.0\textwidth, trim = {1cm 1cm 1cm 0.8cm}, clip]%
    {figures/instrument/PLTlocation.png}% picture filename
    \captionsetup{format=hang}
    \caption{One side of PLT telescopes and their location within CMS \cite{Hall-Wilton:1291202, MFoster2015}.}
\end{figure}


\begin{figure}[htbp!]
\centering
%  \includegraphics[width=1.0\textwidth]%
  \includegraphics[width=0.8\textwidth, trim = {2.5cm 7.2cm 2.5cm 5cm}, clip]%
    {figures/instrument/PLT_module.png}% picture filename
    \captionsetup{format=hang}
    \caption{PLT Module.}
\end{figure}


The Pixel Luminosity Telescope is a dedicated system for measuring the luminosity at
CMS using silicon pixel sensors \cite{Kornmayer2015}. The instrument is positioned close to the beam pipe and directly behind the Forward Pixel detector. It is designed to provide bunch-by-bunch luminosity measurement at the CMS interaction point. It is located at a pseudo rapidity, $|\eta|$, of roughly $4$ and at a mean radial distance of $\sim 5$ cm from the beam. It was installed in January 2015 as part of the Run 2 upgrades for the CMS Beam Radiation Instrumentation and Luminosity (BRIL) project \cite{Dabrowski:1966978}, and has operated successfully throughout the 2015 and 2016 run of the LHC.

%Telescopes are arranged in an x - y plane, parallel to z-axis within a length of 7.5 cm at rapidity, $\eta$, of roughly $4$.


% http://tex.stackexchange.com/questions/66216/draw-arc-in-tikz-when-center-of-circle-is-specified
\begin{figure}[htbp!]
  \begin{minipage}{\textwidth}
  \begin{minipage}[b]{0.49\textwidth}
    \centering
    \begin{tikzpicture}
      \tkzDefPoint(0,0){O}
      \tkzDefPoint(0,1){A}
        \tkzDefPoint(0,2){AA}
      \tkzDefPoint(0,-1){C}
      \tkzDefPoint(0,-2){CC}

      \tkzDrawLines[add = 0 and 0](A,AA)
      \tkzDrawLines[add = 0 and 0](C,CC)

      \tkzDefPoint(22.5:1.7){$02$}
      \tkzDefPoint(67.5:1.8){$01$}
      \tkzDefPoint(112.5:1.8){$11$}
      \tkzDefPoint(157.5:1.75){$10$}
      \tkzDefPoint(202.5:1.48){$08$}
      \tkzDefPoint(247.5:1.4){$07$}
      \tkzDefPoint(292.5:1.4){$05$}
      \tkzDefPoint(337.5:1.49){$04$}

    %\draw[fill=red!30] (O) circle (2);
    \draw (O) circle (2);
    \draw (O) circle (1);

        \tkzLabelPoints[below]($01$,$02$,$04$,$05$,$07$,$08$,$10$,$11$)

% Add text labels outside the detectors
    \node(draw) at (2.5,0) {$+x$};
    \node(draw) at (-2.5,0) {$-x$};
    \node(draw) at (0,0) {$\bigodot$};

    \end{tikzpicture}

%     \caption{PLT Channel Map -Z}
%        \captionsetup{format=hang}
%      \captionof{figure}{PLT module at backward direction (171 cm from IP)}
  \end{minipage}
  \hfill
  \begin{minipage}[b]{0.49\textwidth}
    \centering
\begin{tikzpicture}
  \tkzDefPoint(0,0){O}
  \tkzDefPoint(0,1){A}
    \tkzDefPoint(0,2){AA}
  \tkzDefPoint(0,-1){C}
  \tkzDefPoint(0,-2){CC}

  \tkzDrawLines[add = 0 and 0](A,AA)
  \tkzDrawLines[add = 0 and 0](C,CC)


  \tkzDefPoint(22.5:1.7){$20$}
  \tkzDefPoint(67.5:1.8){$19$}
  \tkzDefPoint(112.5:1.8){$17$}
  \tkzDefPoint(157.5:1.75){$16$}
  \tkzDefPoint(202.5:1.48){$14$}
  \tkzDefPoint(247.5:1.4){$13$}
  \tkzDefPoint(292.5:1.4){$23$}
  \tkzDefPoint(337.5:1.49){$22$}

    %\draw[fill=red!30] (O) circle (2);
    \draw (O) circle (2);
    \draw (O) circle (1);

    \tkzLabelPoints[below]($17$,$20$,$22$,$23$,$13$,$14$,$16$,$19$)

%        \node[draw] at (2.5,0) {-x};
        \node(draw) at (2.5,0) {$-x$};
    \node(draw) at (-2.5,0) {$+x$};
    \node(draw) at (0,0) {$\bigotimes$};


\end{tikzpicture}
%        \captionsetup{format=hang}
%      \captionof{figure}{PLT module at  forward direction (171 cm from IP)}
    \end{minipage}

  \end{minipage}
        \captionsetup{format=hang}
      \captionof{figure}{PLT modules at forward direction(left) and backward direction (right) both located at 171 cm from the interaction point.}
    \label{fig:PLTmodules}
\end{figure}



The PLT consists of a forward and backward module with each having 8 telescopes. Each telescope consists of 3 consecutive planes of silicon pixel detectors spaced apart by 3.75 cm. Each pixel sensor is segmented into of 80 rows and 52 columns of pixels, with each pixel 150 $\mu$ m wide and 100 $\mu$ m high for a total active area of about 8x8 mm$^{2}$. The middle plane is placed 0.102 cm higher than the first plane, and the third plane is placed 0.102 cm higher than the middle plane to maintain an average viewing angle of 0.27 degrees toward the interaction point. 

%The telescopes are placed around the beampipe outside the CMS pixel endcaps, 8 on each side and 22.5 degrees apart.




\subsubsection {Read Out Chip (ROC)}

\begin{figure}[htbp!]
\centering
  \includegraphics[width=1.0\textwidth]%
%  \includegraphics[width=0.8\textwidth, trim = {2.5cm 7.2cm 2.5cm 5cm}, clip]%
    {figures/instrument/PLTcontrols.png}% picture filename
    \captionsetup{format=hang}
    \caption{A schematic of the control and readout logic of Pixel Luminosity Telescope.}
\end{figure}

%% change this
The sensors are read out by a PSI46v2 readout chip (ROC), the same that is used in the CMS pixel detector~\cite{Kastli:2005jj, ROCManual, Barbero:467141}. Each ROCs from each telescopes are connected to a HDI card, which contains the Token Bit Manager (TBM) chip that handles the readout of the series of ROCs~\cite{BartzTBM}. A port card, which manages the communication and control signals, is connected to half of the telescopes in each side which is then connected to opto-motherboard which converts the electrical signals into optical signals. The four telescopes connected to a single port card are identified by their hub number, which are (in clockwise order) 5, 13, 21, and 29 as shown in Appendix Table. \ref{table:mZ} and \ref{table:pZ}.



%\bigskip


%\subsubsection {Front-End Electronics}

\subsubsection {Data Streams}

%% change the wording?
The front-end readout electronics consist of a FEC (Front-End Controller) card, which issues 
commands to the ROCs \cite{Allkofer:2007ek}, and three FED (Front-End Driver) cards \cite{Pernicka:1091743}. One FED is responsible for the readout of the pixel data from the ROCs and is identical to the FEDs used by the pixel detector. The other two FEDs (one for each side of the detector) read out the Fast-OR data from the ROCs. 

The pixel data \cite{Barbero:467141} is read out via Slink and saved to disk on a dedicated computer hard drive, while the Fast-OR data is collected in a histogram with the FED. The histogram contains a bin for each bunch crossing (BX) and is incremented by 1 in case a telescope found at least 1 signal count for each sensor. The counts within the bins are added for every 4096 orbits (lumi nibble) corresponding to a time interval of about 13. ms. The integration occurs via a VME PC which is connected to the FED via an optical bridge.

%every lumi nibble (4096 orbits) and read out via a CAEN VME optical bridge to a VME PC.


%{\bf Fast-OR Data} \\
\noindent
\textit{Fast-OR Data} \\
The 52 columns in a sensor are segmented into a group of double columns, 0-26. Each hit on a double column is registered as a signal. For a given bunch crossing, the hits in double columns per sensor are reported to the FED which tests if there was at least one signal in each of the three planes. This triple-coincidence count rate is translated to luminosity value as described in sec \ref{sec:zero-count}.


%% change this
%{\bf Pixel Data} \\
\noindent
\textit{Pixel Data} \\
Each pixel of a sensor is calibrated beforehand where some amount of charge collected can be translated to some number of hits. Once a sensor registers a charge signal above some threshold value, the pulse height, and pixel address together with the timestamp information is saved to a buffer. Once the pixel detector receives a valid external signal trigger, the information is transferred to the FED via optical connections. 
%, and a set of discrete ADC values translate to some number of hits. 


\subsubsection {Trigger} \label{ssec:trigger}



%wo
The rate of collision, proportional to LHC bunch crossings of 25 ns, translates to a frequency of 40 MHz. A trigger is used to reduce the amount the data to a more manageable rate. To this end, two different approaches were employed: a trigger generated by taking an OR of the fast-or coincidence signals from all of the channels was used in the early 2015 run to maximize the pixel data taken. It means that if any of the channels registered a triple coincidence for a BX, FED looked for hit signals for that BX. Starting late 2015, a purely random trigger at a rate of 2 kHz was used to avoid any systematic uncertainties in the trigger that could have been introduced by our choice of using fast-or signals for trigger signals. 


%Cycling trigger was used in 2016 where trigger gets shifted by 1579 BX every 3 orbits to achieve  sufficiently random trigger as seen in Fig. \ref{fig:trigger}


\begin{figure}[htbp!]
  \includegraphics[width=1.0\textwidth]%
    {figures/slink/triggerf5151.png}% picture filename
        \captionsetup{format=hang}
%    \caption{Bunches triggered via random trigger setup for Fill 4444 (2015)}
    \caption{Bunches triggered via random trigger setup for $\sim$10 lumi sections from Fill 5151 (2016) with 1579 BX cycling every 3 orbits.}
      \label{fig:trigger}
\end{figure}

TTCci hardware supports internal random trigger or a fixed sequence of intervals \cite{TTCI} . In order to achieve a sufficiently random trigger within 3564 bins and achieve a manageable rate of ~3 kHz, the trigger is made to advance by 1585 bunches every 3 orbits (out of 4096 per nibble). Fig. \ref{fig:trigger} shows the BXes triggered via random trigger setup for the Fill 4444 from September 30, 2015. One downside of having a random trigger approach is that pixel data gets saved at a high rate even when there is no beam.

%-# TTCci configuration file for taking data. Can be set up to
%-# use either the fast-or trigger or a random trigger. For the
%-# fast-or trigger, set TRIGGER_SOURCE to FRONTPANEL0 and
%-# comment out the TRIGGER_FREQUENCY_HZ line. For the random
%-# trigger, set TRIGGER_SOURCE to INTERNAL and uncomment the
%-# TRIGGER_FREQUENCY_HZ ... RANDOM line.
%+# TTCci configuration file for taking data. This is set up
%+# to use a cycling trigger which should advance by 1585 BX
%+# each time and triggers every 3+(1579/3564) orbits (~3.26 kHz).
%+# Why 1579? Because we want a total cycle (which naturally
%+# takes 3564 orbits) to take a multiple of 4096 orbits (1
%+# nibble). This would suggest 1596 but we actually want a little
%+# bit less (a) so we have a number relatively prime to 3564
%+# and also (b) because there is a bit of time when the trigger
%+# is paused, so we want to account for that in our cycle.

% orbit frequency--11.2455 kHz


%One thing that might be worth considering is that this means we'll be
%taking a lot of Slink data even when there is no beam (of course, since
%there are no actual collisions, the events will be empty). It might be
%useful thus to disable triggers during no beam periods (although I'm not
%sure when we would want to reenable them -- injection probe beam or
%injection physics beam, maybe)?


%Slink data for high luminosity runs are generally regulated by the random trigger as shown in Fig. \ref{fig:trigger}. Sufficiently random within 3564 bunches. TTCci to produce random trigger 1-3 KHz. Useful to get data from unfilled BXes too so we can monitor the noise. For special runs like VdM, a special trigger is used to maximize the data taken. Fig. \ref{fig:trigger} shows a sample trigger rate for Fill 4444. VdM Fill 4954 had only 37 bunches triggered.




\subsection{Triple coincidence measurement}
Real tracks are assumed to hit all three planes in a given telescope. In other words, the magnetic field has little effect on the trajectory of particles hitting the telescopes. The fast-or data is saved in a histogram where each bin is separated by 25 ns bunch spacing. Each bin of the histogram records the number all the triple coincidences on all three planes for each telescope over a 1 lumi-nibble which is 4096 orbits.

%Assuming that the true tracks, although under some magnetic field, does not bend far enough to
%the fast-or data is histogrammed on the FED every lumi nibble (4096 orbits) and read out via a  CAEN VME optical bridge to a VME PC.
Figure \ref{fig:tripleCoincidences} shows the occupancies in a single telescope of the Pixel Luminosity Telescope (PLT) with a mask applied to reduce the active area of the central plane to 4mm x 4mm. This plot shows only events where a triple coincidence (a simultaneous hit in all three planes) occurred in this specific telescope, allowing us to measure the effects of alignment and accidentals.

\begin{figure}
  \includegraphics[width=1.0\textwidth]%
    {figures/display/trackoccupancies3850.png}% picture filename
    \caption{Tracks which make through all 3 planes with a mask of 4mm x 4mm.}
    \label{fig:tripleCoincidences}
\end{figure}

In order to decrease the contribution from combinatoric effects producing fake triple coincidences, the active area of the sensors was decreased by masking out outer pixels. The center plane of each telescope was reduced to an active area of 4.2x4.0 mm (28 columns x 40 rows) and the outer two planes to 5.4x5.2 mm (36 columns x 52 rows).


During early commissioning operations, Channels 22 and 23 in Fig. \ref{fig:PLTmodules},  stopped responding and were dropped from the luminosity calculations. One more telescope, Channel 1 also was taking out of the calculation in 2016 data taking period.



\subsection{Zero Counting Algorithm} \label{sec:zero-count}
%The PLT is located at rapidity of $\approx 4$ and is expected to receive $\approx 300-400$ coincidences per bunch crossing, which translates to about 0.1 coincidences per orbit. 
The average occupancy of the PLT at the LHC design luminosity is about 0.1 per BX. For a given telescope, the number of hits that it receives in a bunch crossing can be considered a simple counting experiment. Figure \ref{fig:pBXfor} shows the mean number of coincidence count per telescope for a sample data. 

The number of hits is proportional to the length of the interval, which is 25ns in our case. The probability of occurrence of two or more hits is very small and the number of events for one bin is independent of what happens in another bin. As such, the triple-coincidence count can be treated as a problem in Poisson statistics as described in sec \ref{sec:lumiMeasurement}.
%the average occupancy of the PLT at the LHC design luminosity is about 0.1 per BX

%In other words, the mean count of coincidence per bunch crossing for a given telescope is 0.1

\begin{figure}[htbp!]
  \includegraphics[width=1.0\textwidth]%
    {figures/FastOR/perChNB.png}% picture filename
    \captionsetup{format=hang}
    \caption{Per channel average coincidence count for 1 nibble sample from Fill 4444 (2015). }
      \label{fig:pBXfor}
\end{figure}

%
%\subsubsection{Poission Statistics}
%The probability of observing k number of events in an interval is given by
%
%$$
%P (k) = \frac{\lambda^{k} e^{-\lambda}}{k!}
%$$
%where $\lambda$ is the average number of events per interval. The probability of observing 0 events, therefore, is given by
%\begin{equation}\label{eq:pzero}
%P (0) = e^{-\lambda} = 1 + \lambda + \frac{\lambda^{2}}{2!} + \frac{\lambda^{3}}{3!}+ \frac{\lambda^{4}}{4!} + ...
%\end{equation}
%We are interested in knowing $\lambda$, the mean number of observed events which is one parameter that should be proportional to luminosity. We know that the total probability, $P = 1 = P(0) + P(1+)$. So, the probability of getting no hits is given by
%%\begin{equation} \label{eq:totprob}
%$P(0) = 1 - P(1+).$
%%\end{equation}
%Now, we use this relationship to get the $\lambda$ by equating this with the log of \ref{eq:pzero} as follows: %Taking log of \ref{eq:pzero} and equating with \ref{eq:totprob}, we get,
%
%\begin{equation} \label{eq:lambdaZ}
%\lambda = -log(1 - P(1+))
%\end{equation}
%
%\noindent
%A telescope can technically record upto 4096 coincidences, 1 for each orbit. However, the average number of coincidences that PLT measures is about 300 as shown in Fig. \ref{fig:pBXfor} i.e. there is less than 1 in 10 chance for a telescope to register a triple coincidence for a filled bunch in an orbit. From equation \ref{eq:lambdaZ} we see that for higher value of P(1+) (which means larger fraction of orbits with coincidences), value of $\lambda$ becomes larger because the argument of log gets smaller. 
%
%
%\noindent
%Calibration coefficient is extracted from the VdM scans, and applied to each channels as described in section \ref{sec:vdmCalib}. Thus, provided that we have a calibration constant for each channel from some other methods, zero-counting method correctly gives the average number of inelastic pp collisions/BX via equation \ref{eq:lambdaZ}.



\subsection{Van der Meer Scan Calibration} \label{sec:vdmCalib}
% vdm for 2015 under fast-or trigger

%%wo
The Van der Meer (VdM) scans procedure \cite{vanderMeer:296752} is used to measure the conversion factor between the number of tracks measured by the PLT and the delivered luminosity as described in \ref{sec:lumiCalibration}. The LHC performed the VdM procedure for CMS on 24th August 2015 (LHC Fill 4266), and on 27th May 2016 (LHC Fill 4954)

%Analysis of VdM tracks is done by assuming that the LHC beam is approximately Gaussian. The two colliding beams are separated by up to 6 $\sigma$ in 0.5 $\sigma$ steps. This procedure is repeated along both the horizontal (crossing scan-X) and vertical (separation scan-Y) axes in the CMS coordinate system. The LHC performed the VdM procedure for CMS on 24th August 2015 (LHC Fill 4266), and on 27th May 2016 (LHC Fill 4954). This procedure is repeated three times each along the X and Y axes during which both beams are made to move in tandem across one another. Two additional pairs of beam imaging scans were also performed keeping each beam stationary while the other beam scans across it. 
%The beam imaging scans also cover the same separation range in both X and Y direction as the standard pairs.
%%wo




%The conversion factor between the number of tracks measured in the PLT and the delivered
%luminosity is derived from analysis of a Van der Meer (VdM) scan procedure \cite{vanderMeer:296752}. Assuming the LHC beam shape to be generally Gaussian, the two colliding beams are separated by 6s and scanned across another in steps of 0.5s. This scan is performed along both the X (crossing scan) and Y (separation scan) axes in the CMS coordinate system. The LHC performed the
%VdM procedure for CMS overnight on 24 August 2016, during LHC Fill 4266. The scan was
%performed three times apiece along the X and Y axes, in which both beams were moved in
%tandem across one another. An additional two pairs of beam imaging scans were performed
%in which one of the LHC beams remained stationary while the another beam is scanned across it. The beam imaging scans cover the same range of separation as the three standard pairs.

%\subsubsection{Conversion Factor}

%\begin{figure}[htbp!]
%\centering
%    % trim = {<left> <lower> <right> <upper>}
%  \includegraphics[width=0.5\textwidth, trim = {0cm 0cm 0.5cm 0cm}, clip]%
%    {figures/aan-plots/XFitScan1.png}% picture filename
%    \captionsetup{format=hang}
%    \caption{X-Scan1 fit for Fill 4266 (2015) }
%      \label{fig:pBXfor}
%\end{figure}




%\begin{figure}[htp]
%\begin{center}
%\includegraphics[width=0.49\textwidth]{figures/aan-plots/XFitScan2.png}
%\includegraphics[width=0.49\textwidth]{figures/aan-plots/YFitScan2.png}
%\caption{Double Gaussian fit to PLT track rate as a function of beam separation, for bunch 1011 during the second separation/crossing VdM scan in X and Y.
%\label{fig:Scan2Fits}}
%\end{center}
%\end{figure}

The relationship between the instantaneous luminosity provided by the LHC and the mean number of tracks per bunch crossing, $\mu_{tracks}$, is given by

%The mean number of tracks per bunch crossing, $\mu_{tracks}$, is related to the i
%nstantaneous luminosity at the LHC by:

$$\cfrac{dL}{dt} = \cfrac{\mu_{tracks}f} {\sigma_{vis}}$$

\noindent
Where $f$ is the LHC revolution frequency of 11,246 Hz and $\sigma_{vis}$ is the fraction of the total inelastic cross-section of CMS visible to the PLT.  One can then determine $\sigma_{vis}$ via the VdM procedure, as described in section \ref{sec:lumiCalibration} and \ref{sec:lumiMeasurement}, using only the LHC beam parameters as follows:
%,  allows us to determine $\sigma_{vis}$ assuming the instantaneous luminosity may also be derived from LHC machine parameters alone from the relation

$$\cfrac{dL}{dt} = \cfrac{I_{1}I_{2}f}{2\pi\sigma_{x}\sigma_{y}}$$

Here, $I_{1}$ and $I_{2}$ are the measured beam currents, and $\sigma_{x}$ and $\sigma_{y}$ are the beam width parameters along the x and y-axes.  The LHC Fast Bunch Current Transformers (FBCT) and beam Quality Monitoring (BQM) independently provide a bunch-to-bunch measurement of beam currents. The measured current over bunches is then normalized to the total current by the Direct-Current Current Transformers (DCCT). Figure \ref{fig:lumiCompare} shows a comparison of the luminosity measurement via LHC parameters and Pixel Luminosity Detector for the CMS experiment \cite{PLT:AN-16-002_v3}.



\begin{figure}[htbp!]
\begin{center}
  \includegraphics[width=1.0\textwidth]%
%    {figures/instrument/25ns_fill_scheme.png}% picture filename
%  {figures/model/Standard_Model_of_Elementary_Particles.svg.png}
  {figures/intro/Fill5253LumiCompare.png}
    \captionsetup{format=hang}
  \caption{Comparison of luminosity measured via LHC beam parameters (green) and Pixel Luminosity Detector (blue) for the CMS experiment, Fill 5253.}% The PLT luminosity drops when data taking ...}
  \label{fig:lumiCompare}
\end{center}

\end{figure}

$\sigma_{x}$ and $\sigma_{y}$ are derived from fits of the observed number of PLT Fast-OR as a function of the beam separation. For each of the five scan pairs, the beams are moved between +6$\sigma$ and -6$\sigma$ in steps of $0.5\sigma$.  Each fit can then be performed on the resulting 25 data points.  As the beam has been found to be non-Gaussian to a degree, the fit is performed using a combination double-Gaussian function

%The VdM scan is performed with special optics, in which the beam profile in x and y can be assumed to be roughly Gaussian with no crossing angle between the beams.


%The beam currents are derived from two independent sources; the LHC Fast Bunch Current Transformers (FBCT) and Beam Quality Monitoring (BQM) which provide the measurement on a bunch-by-bunch basis.  The total measured current over all bunches is then normalized to the total orbital current as given by the Direct-Current Current Transformers (DCCT).

%The remaining factors $\sigma_{x}$ and $\sigma_{y}$ are derived from fits of the
%observed number of PLT tracks as a function of the beam separation.  For each of
%the five scan pairs, the beams are moved between +6$\sigma$ and -6$\sigma$ in ste
%ps of $0.5\sigma$.  Each fit can then be performed on the resulting 25 data point
%s.  As the beam has been found to be non-Gaussian to a degree, the fit is performed
%ed using a combination double-Gaussian function

$$
R(\Delta_{x/y}) = a_{1}\exp{\cfrac{-(\Delta_{x/y} - \mu)^{2}}{2\sigma^{2}_{1}}} + a_{2}\exp{\cfrac{-(\Delta_{x/y} - \mu)^{2}}{2\sigma^{2}_{2}}}
 $$

where the means of each Gaussian are constrained to be equal, and the effective constant $a_{eff}$ and effective width $\sigma_{eff}$ are given by:

$$a_{eff} = a_{1} + a_{2}$$

$$\sigma_{eff} = \cfrac{a_{1}\sigma_{1} + a_{2}\sigma_{2}}{a_{1} + a_{2}}.$$


\begin{figure}[htp]
\begin{center}
\includegraphics[width=0.49\textwidth]{figures/aan-plots/XFitScan1.png}
\includegraphics[width=0.49\textwidth]{figures/aan-plots/YFitScan1.png}
        \captionsetup{format=hang}
%\caption{Double Gaussian fit to PLT track rate as a function of beam separation, for bunch 1011 during the first separation/crossing VdM scan in X and Y.}
\caption{Double Gaussian fit to PLT track rate as a function of beam separation, for bunch 1011 during the first separation VdM scan in X and Y.}
\label{fig:Scan1Fits}
\end{center}
\end{figure}

The final conversion factors extracted vis the vdm scan for 2016 is 328 inverse microbarns/second with an uncertainty of ~5\%. %respectively with a relative uncertainty of ...\%.

%The number for 2016 is presently 328 inverse microbarns/second with an uncertainty of ~5%.  This uncertainty is inflated due to an extrapolation from 2015 conditions.